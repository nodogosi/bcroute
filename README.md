# GPX表示・描画地図ツール 設計仕様書

## 🗺 概要

Leaflet と国土地理院の地図タイルを使用し、次の 2 モードを切り替えて利用できる地図アプリケーションです：

- **GPX表示モード**：CSVファイルに登録されたGPXファイルを選択・表示する。
- **ルート描画モード**：ユーザーが地図上をクリックしてルートを作成でき、将来的にはGPXファイルとして出力可能。

---

## 📁 入力ファイル

### `yamareco_yamakassou.csv`

| フィールド名   | 内容例                         | 説明                       |
|----------------|----------------------------------|----------------------------|
| area           | 白馬岳                          | 地域名                     |
| route_name     | 白馬主稜                        | ルート名                   |
| date           | 2025-04-01                      | 登録日                     |
| gpx_file       | routes/track-1234.gpx           | GPXファイルのパス          |
| url            | htmls/白馬主稜.html             | GPXに対応するHTMLリンク   |

---

## 🖥 機能仕様

### 🔘 共通機能

- 地図：国土地理院の標準タイル（https://cyberjapandata.gsi.go.jp/xyz/std/）
- GPX表示：
  - 赤線（透明度60%、太さ4）で描画
  - マウスオーバー時に青に変化、日付とルート名を表示
  - クリックで `url` に登録されたページを別タブで開く（表示モード時のみ）

---

### 📌 GPX表示モード（`view`）

#### UI構成

- 地域名（セレクトボックス）
- 日付（地域名が選ばれると表示）
- ルート名（日付が選ばれると表示）
- [ルート表示]ボタン
- [クリア]ボタン

#### 挙動

- 地域・日付・ルート名を選択後、該当GPXを地図に表示
- 複数のGPXを重ねて表示可能
- [クリア] ボタンですべてのGPXを非表示にする

---

### ✏️ ルート描画モード（`draw`）

#### UI構成

- [GPX出力]（未実装）
- [描画クリア]ボタン

#### 挙動

- 地図をクリックでマーカーを設置
- 2点目以降は、前点との間に青線を描画
- マーカーを再クリックで、最後の線とマーカーを削除
- GPX表示中でも描画可能（GPXにはインタラクションなし）

---

## 🛠 技術仕様

| 項目           | 使用技術                         |
|----------------|----------------------------------|
| 地図描画       | Leaflet.js 1.9.4                |
| GPX解析        | leaflet-gpx 1.5.0               |
| 背景地図       | 地理院タイル（GSI Maps）        |
| CSV読込        | Fetch API + JavaScript          |
| UI構成         | HTML + CSS（簡易スタイル）      |

---

## 🧪 将来的な拡張案

- [ ] GPX出力機能（drawモード用）
- [ ] URLパラメータによる初期状態の制御
- [ ] スマホ対応レイアウトの改善
- [ ] ルートのグルーピング・カラー別表示機能

---

## ✅ モード別のインタラクション制御

| 操作               | 表示モード（view） | 描画モード（draw） |
|--------------------|---------------------|---------------------|
| GPXの吹き出し表示   | ○（マウスオーバー） | ✕（無効）          |
| GPXクリック         | ○（HTMLリンク開く） | ✕（無効）          |
| 地図クリック        | ✕（なし）           | ○（描画開始）      |
| 描画線・点の削除    | ✕                   | ○（マーカー再クリック） |

---

